<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ultra Newspaper Text Generator</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Roboto+Slab&family=Courier+Prime&display=swap');
  :root {
    --light-bg: #f9f6f1;
    --light-text: #111;
    --light-glass: rgba(255 255 255 / 0.85);
    --dark-bg: #121212;
    --dark-text: #eee;
    --dark-glass: rgba(18 18 18 / 0.85);
    --accent: #f5c800;
    --btn-bg: #333;
    --btn-hover: #f5c800;
    --overlay-bg: rgba(0,0,0,0.6);
  }
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; padding: 20px;
    background: var(--light-bg);
    color: var(--light-text);
    font-family: 'Playfair Display', serif;
    transition: background 0.4s ease, color 0.4s ease;
    text-align: center;
    min-height: 100vh;
    display: flex; flex-direction: column; align-items: center;
  }
  body.dark {
    background: var(--dark-bg);
    color: var(--dark-text);
  }
  h1 {
    font-size: 2.5rem;
    margin-bottom: 20px;
    letter-spacing: 1.5px;
  }
  #controls {
    background: var(--light-glass);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    border-radius: 15px;
    padding: 20px 30px;
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center;
    max-width: 900px;
    margin-bottom: 25px;
    box-shadow: 0 8px 32px rgba(245, 200, 0, 0.15);
    transition: background 0.4s ease;
    position: relative;
    z-index: 5;
  }
  body.dark #controls {
    background: var(--dark-glass);
    box-shadow: 0 8px 32px rgba(245, 200, 0, 0.25);
  }
  input#txt {
    flex: 1 1 300px;
    padding: 15px 20px;
    font-size: 1.2rem;
    border: none;
    border-radius: 12px;
    font-family: 'Roboto Slab', serif;
    color: var(--light-text);
    background: rgba(255 255 255 / 0.9);
    box-shadow: inset 0 0 8px #ccc;
    transition: background 0.3s ease, color 0.3s ease;
  }
  body.dark input#txt {
    color: var(--dark-text);
    background: rgba(30 30 30 / 0.85);
    box-shadow: inset 0 0 10px #222;
  }
  #charCount {
    width: 50px;
    text-align: right;
    font-weight: 600;
    color: var(--accent);
    align-self: center;
    user-select: none;
  }
  select#font {
    padding: 12px 20px;
    font-size: 1.1rem;
    border-radius: 12px;
    border: none;
    font-family: 'Roboto Slab', serif;
    cursor: pointer;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    transition: box-shadow 0.3s ease;
    min-width: 180px;
  }
  select#font:hover, select#font:focus {
    box-shadow: 0 0 15px var(--accent);
    outline: none;
  }
  button {
    padding: 15px 25px;
    font-size: 1.1rem;
    font-weight: 700;
    border-radius: 15px;
    border: none;
    cursor: pointer;
    background: var(--btn-bg);
    color: white;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    transition: background 0.3s ease, box-shadow 0.3s ease;
    flex: 1 1 140px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
  }
  button:hover {
    background: var(--btn-hover);
    color: var(--dark-bg);
    box-shadow: 0 8px 25px var(--btn-hover);
  }
  button svg {
    width: 22px; height: 22px;
    fill: currentColor;
  }
  canvas {
    max-width: 900px;
    width: 90vw;
    border-radius: 18px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    border: 3px solid var(--accent);
    background: white;
    transition: background 0.4s ease, border-color 0.4s ease;
    position: relative;
    z-index: 1;
  }
  body.dark canvas {
    background: #222;
    border-color: var(--accent);
  }
  #toggleTheme {
    margin-top: 25px;
    cursor: pointer;
    font-size: 1.2rem;
    font-weight: 600;
    user-select: none;
    display: inline-flex;
    align-items: center;
    gap: 10px;
    color: var(--accent);
    transition: color 0.4s ease;
    position: relative;
    z-index: 5;
  }
  #toggleTheme:hover {
    color: #fff700;
  }
  #toggleTheme svg {
    width: 24px; height: 24px;
    fill: var(--accent);
    transition: fill 0.4s ease;
  }
  body.dark #toggleTheme svg {
    fill: var(--accent);
  }
  #overlay {
    position: fixed;
    inset: 0;
    background: var(--overlay-bg);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-family: 'Roboto Slab', serif;
    color: white;
    font-size: 2.5rem;
    font-weight: 700;
    letter-spacing: 1px;
    z-index: 9999;
    user-select: none;
    visibility: hidden;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  #overlay.visible {
    visibility: visible;
    opacity: 1;
  }
  #overlay small {
    font-size: 1.2rem;
    font-weight: 400;
    margin-top: 8px;
    letter-spacing: normal;
    color: #f5c800cc;
  }
  @media (max-width: 600px) {
    #controls {
      flex-direction: column;
      padding: 15px;
    }
    button {
      flex: 1 1 100%;
    }
    select#font, input#txt {
      width: 100%;
    }
    #charCount {
      width: auto;
      align-self: flex-end;
      margin-top: -8px;
      margin-bottom: 12px;
      font-size: 1rem;
    }
  }
</style>
</head>
<body>
<h1>Ultra Newspaper Text Generator</h1>
<div id="controls">
  <input id="txt" maxlength="100" placeholder="Enter text (max 100 chars)" value="Breaking News!">
  <div id="charCount">14</div>
  <select id="font" title="Choose font">
    <option value="Playfair Display" style="font-family:'Playfair Display', serif;">Playfair Display</option>
    <option value="Roboto Slab" style="font-family:'Roboto Slab', serif;">Roboto Slab</option>
    <option value="Courier Prime" style="font-family:'Courier Prime', monospace;">Courier Prime</option>
    <option value="Arial" style="font-family:Arial, sans-serif;">Arial</option>
  </select>
  <button id="create" title="Create Image">
    <svg viewBox="0 0 24 24"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
    Create
  </button>
  <button id="savePng" title="Download PNG" disabled>
    <svg viewBox="0 0 24 24"><path d="M19 21H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h4l2-3 2 3h4a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2z"/></svg>
    Download PNG
  </button>
  <button id="saveMp4" title="Download Video" disabled>
    <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
    Download Video
  </button>
</div>
<canvas id="canvas" width="900" height="450" aria-label="Newspaper text preview" role="img" tabindex="0"></canvas>
<div id="toggleTheme" title="Switch Theme" role="button" tabindex="0" aria-pressed="false" aria-label="Toggle dark/light theme">
  <svg id="iconTheme" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/></svg>
  Switch Theme
</div>
<div id="overlay" aria-live="polite" aria-atomic="true"></div>

<script>
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const txt = document.getElementById('txt');
  const fontSelect = document.getElementById('font');
  const charCount = document.getElementById('charCount');
  const createBtn = document.getElementById('create');
  const savePngBtn = document.getElementById('savePng');
  const saveMp4Btn = document.getElementById('saveMp4');
  const toggleThemeBtn = document.getElementById('toggleTheme');
  const iconTheme = document.getElementById('iconTheme');
  const overlay = document.getElementById('overlay');

  const newspapers = [
    'https://cdn.pixabay.com/photo/2017/08/30/20/12/newspaper-2690259_960_720.jpg',
    'https://cdn.pixabay.com/photo/2015/12/03/09/59/newspapers-1072540_960_720.jpg',
    'https://cdn.pixabay.com/photo/2017/09/26/16/02/newspapers-2783234_960_720.jpg',
    'https://cdn.pixabay.com/photo/2014/08/05/10/31/newspapers-409617_960_720.jpg',
    'https://cdn.pixabay.com/photo/2016/10/06/17/06/newspapers-1723373_960_720.jpg',
    'https://cdn.pixabay.com/photo/2016/10/05/17/52/donald-trump-1715718_960_720.jpg',
    'https://cdn.pixabay.com/photo/2017/08/22/19/29/newspaper-2662984_960_720.jpg',
    'https://cdn.pixabay.com/photo/2017/05/12/16/53/newspaper-2308408_960_720.jpg',
    'https://cdn.pixabay.com/photo/2016/02/14/11/17/newspaper-1191470_960_720.jpg',
    'https://cdn.pixabay.com/photo/2015/09/09/19/27/newspaper-933291_960_720.jpg'
  ];

  let dark = false;
  let currentImage = null;

  function showOverlay(message, submessage) {
    overlay.innerHTML = `${message}<br><small>${submessage || ''}</small>`;
    overlay.classList.add('visible');
  }
  function hideOverlay() {
    overlay.classList.remove('visible');
  }

  function drawImageAndText() {
    return new Promise((resolve) => {
      const text = txt.value.trim().substring(0, 100);
      const font = fontSelect.value;
      const img = new Image();
      img.crossOrigin = 'anonymous';
      currentImage = newspapers[Math.floor(Math.random() * newspapers.length)];
      img.src = currentImage;
      img.onload = () => {
        ctx.resetTransform();
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

        ctx.font = `bold 32px '${font}'`;
        ctx.fillStyle = dark ? '#eee' : '#111';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'top';
        ctx.shadowColor = 'rgba(0,0,0,0.25)';
        ctx.shadowBlur = 3;

        const maxWidth = canvas.width * 0.85;
        const lineHeight = 42;
        let y = 60;

        const words = text.split(' ');
        let line = '';
        for (const word of words) {
          const testLine = line + word + ' ';
          if (ctx.measureText(testLine).width > maxWidth) {
            ctx.fillText(line.trim(), canvas.width / 2, y);
            line = word + ' ';
            y += lineHeight;
          } else {
            line = testLine;
          }
        }
        ctx.fillText(line.trim(), canvas.width / 2, y);

        resolve();
      };
      img.onerror = () => {
        alert('Failed to load newspaper background image. Please try again.');
        resolve();
      };
    });
  }

  function calculateDelay(textLength) {
    // Base 2 seconds for up to 30 chars + 0.05 sec per extra char capped at 5 sec max
    if (textLength <= 30) return 2000;
    const extra = (textLength - 30) * 50;
    return Math.min(2000 + extra, 5000);
  }

  async function onCreate() {
    const textLength = txt.value.trim().length;
    if (!textLength) {
      alert('Please enter some text!');
      return;
    }
    createBtn.disabled = true;
    savePngBtn.disabled = true;
    saveMp4Btn.disabled = true;
    const delay = calculateDelay(textLength);

    showOverlay(`Creating in... <span id="countdown">${Math.ceil(delay/1000)}</span>`, 'Please wait');

    let remaining = delay;
    const countdownEl = document.getElementById('countdown');
    const interval = setInterval(() => {
      remaining -= 1000;
      countdownEl.textContent = Math.ceil(remaining / 1000);
      if (remaining <= 0) {
        clearInterval(interval);
      }
    }, 1000);

    await new Promise(r => setTimeout(r, delay));
    await drawImageAndText();

    hideOverlay();
    createBtn.disabled = false;
    savePngBtn.disabled = false;
    saveMp4Btn.disabled = false;
  }

  function prepareDownload(button, fileType) {
    button.disabled = true;
    showOverlay(`Preparing your ${fileType} file...`, 'Do not close or reload the page!');
  }

  savePngBtn.onclick = () => {
    prepareDownload(savePngBtn, 'PNG');
    setTimeout(() => {
      const a = document.createElement('a');
      a.href = canvas.toDataURL('image/png');
      a.download = 'newspaper_text.png';
      a.click();
      hideOverlay();
      savePngBtn.disabled = false;
    }, 1500);
  };

  saveMp4Btn.onclick = async () => {
    prepareDownload(saveMp4Btn, 'video');
    saveMp4Btn.disabled = true;

    const stream = canvas.captureStream(30);
    const recorder = new MediaRecorder(stream, { mimeType: 'video/webm' });
    const chunks = [];
    recorder.ondataavailable = (e) => chunks.push(e.data);
    recorder.onstop = () => {
      const blob = new Blob(chunks, { type: 'video/webm' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'newspaper_text.webm';
      a.click();
      hideOverlay();
      saveMp4Btn.disabled = false;
    };
    recorder.start();

    // 60 frames, 2 seconds video approx
    let frames = 60;
    let count = 0;

    const interval = setInterval(() => {
      drawImageAndText();
      count++;
      if (count >= frames) {
        clearInterval(interval);
        recorder.stop();
      }
    }, 1000 / 30);
  };

  createBtn.onclick = onCreate;

  toggleThemeBtn.onclick = () => {
    dark = !dark;
    document.body.classList.toggle('dark');
    iconTheme.innerHTML = dark
      ? '<path d="M21 12.79A9 9 0 0112.21 3 7 7 0 1012 21a9 9 0 009-8.21z"/>'
      : '<circle cx="12" cy="12" r="5"/>';
    drawImageAndText();
  };

  txt.addEventListener('input', () => {
    charCount.textContent = txt.value.length;
    if (txt.value.length > 100) {
      txt.value = txt.value.substring(0, 100);
    }
  });

  // Başlangıçta çizim
  drawImageAndText();
</script>
</body>
</html>
