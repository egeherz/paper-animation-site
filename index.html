<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ultra Modern 3D Paper Text Animator</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&family=Roboto+Mono&display=swap');
  :root {
    --color-bg-dark: #121212;
    --color-bg-light: #fdfdfd;
    --color-text-dark: #eee;
    --color-text-light: #222;
    --color-accent: #f5c518;
    --transition: 0.3s ease;
  }
  html, body {
    margin:0; padding:0; height:100%;
    font-family: 'Poppins', sans-serif;
    background: var(--color-bg-dark);
    color: var(--color-text-dark);
    display:flex; flex-direction: column; align-items: center;
    justify-content: flex-start;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  body.light {
    background: var(--color-bg-light);
    color: var(--color-text-light);
  }
  h1 {
    margin: 1.5rem 0 0.5rem;
    font-weight: 700;
    font-size: 2rem;
    user-select:none;
  }
  #controls {
    margin-bottom: 1rem;
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    justify-content: center;
    width: 90vw;
    max-width: 900px;
  }
  input[type="text"] {
    flex: 1 1 300px;
    padding: 0.7rem 1rem;
    font-size: 1.2rem;
    border-radius: 8px;
    border: 2px solid var(--color-accent);
    background: transparent;
    color: inherit;
    transition: border-color var(--transition);
  }
  input[type="text"]:focus {
    outline: none;
    border-color: #ffaa00;
    box-shadow: 0 0 8px #ffaa00aa;
  }
  button {
    padding: 0.7rem 1.5rem;
    font-size: 1.1rem;
    font-weight: 700;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    background: var(--color-accent);
    color: #121212;
    transition: background-color var(--transition), transform var(--transition);
    user-select:none;
  }
  button:disabled {
    background: #444;
    cursor: default;
    color: #999;
  }
  button:hover:not(:disabled) {
    background: #ffb800;
    transform: scale(1.05);
  }
  #themeToggle {
    padding: 0.7rem 1rem;
    background: none;
    border: 2px solid var(--color-accent);
    color: var(--color-accent);
    font-weight: 600;
    border-radius: 8px;
    cursor: pointer;
    user-select:none;
    transition: background-color var(--transition), color var(--transition);
  }
  #themeToggle:hover {
    background: var(--color-accent);
    color: #121212;
  }

  #preview {
    position: relative;
    width: 90vw;
    max-width: 900px;
    height: 50vh;
    min-height: 320px;
    background: #000;
    border-radius: 16px;
    border: 3px solid var(--color-accent);
    overflow: hidden;
    perspective: 900px;
    box-shadow: 0 0 25px #ffaa00aa;
    user-select:none;
  }
  #backgroundLayer, #mainLayer {
    position: absolute; inset:0;
    display: flex;
    justify-content: center;
    align-items: center;
    pointer-events: none;
  }
  #backgroundLayer {
    display: none;
    transform-style: preserve-3d;
  }
  #backgroundLayer span {
    position: absolute;
    top: 50%; left: 50%;
    transform-style: preserve-3d;
    transform-origin: center center;
    white-space: pre-wrap;
    font-family: 'Roboto Mono', monospace;
    font-weight: 600;
    opacity: 0.2;
    user-select:none;
    color: var(--color-accent);
    text-shadow: 0 0 3px #ffca2caa;
    transition: transform 0.3s ease;
  }
  #mainLayer {
    display: none;
    font-family: 'Roboto Mono', monospace;
    font-weight: 900;
    color: var(--color-accent);
    text-shadow:
      0 0 5px #ffdd4c,
      0 0 10px #ffdd4c;
    pointer-events:none;
  }

  @keyframes slowRotate {
    0% { transform: rotateX(0deg) rotateY(0deg) translateZ(0); }
    50% { transform: rotateX(10deg) rotateY(10deg) translateZ(20px); }
    100% { transform: rotateX(0deg) rotateY(0deg) translateZ(0); }
  }

  #backgroundLayer.animate {
    display: block;
    animation: slowRotate 10s ease-in-out infinite;
  }
  #mainLayer.show {
    display: flex;
  }

  #overlay {
    position: fixed;
    inset: 0;
    background: rgba(18,18,18,0.85);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-accent);
    font-size: 2rem;
    font-weight: 600;
    text-align: center;
    padding: 1rem 2rem;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    user-select:none;
    z-index: 9999;
  }
  #overlay.visible {
    opacity: 1;
    pointer-events: auto;
  }
</style>
</head>
<body>
<h1>Ultra Modern 3D Paper Text Animator</h1>
<div id="controls">
  <input id="txt" maxlength="100" placeholder="Enter up to 100 characters" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
  <button id="create">Create</button>
  <button id="downloadPng" disabled>Download PNG</button>
  <button id="downloadMp4" disabled>Download MP4</button>
  <button id="themeToggle" aria-label="Toggle Light/Dark Theme">Light Mode</button>
</div>

<div id="preview" aria-live="polite" aria-atomic="true" role="region">
  <div id="backgroundLayer" aria-hidden="true"></div>
  <div id="mainLayer" aria-live="assertive"></div>
</div>

<div id="overlay" role="alert" aria-live="assertive" aria-atomic="true"></div>

<script>
(() => {
  const blurTexts = [
    "Breaking news: markets rally globally.",
    "Scientists unveil new quantum breakthrough.",
    "Health experts emphasize balanced diet.",
    "Technology trends shape modern life.",
    "Climate action urgent, say world leaders.",
    "Sports highlights: underdog wins trophy.",
    "SpaceX readies next Mars mission launch.",
    "AI ethics spark debate in tech circles.",
    "Travel restrictions ease with vaccines.",
    "Education reforms aim for inclusivity.",
    "Renewable energy adoption accelerates.",
    "Cultural festivals return post-pandemic.",
    "Finance tips: saving for the future.",
    "Art exhibitions blend tradition & tech.",
    "Urban planning redefines smart cities.",
    "Cybersecurity threats on the rise.",
    "Medical research finds cancer marker.",
    "Social media influences modern politics.",
    "Economists predict steady recovery.",
    "Gaming industry reaches new heights."
  ];

  const txt     = document.getElementById('txt');
  const create  = document.getElementById('create');
  const dlPng   = document.getElementById('downloadPng');
  const dlMp4   = document.getElementById('downloadMp4');
  const bgLayer = document.getElementById('backgroundLayer');
  const mainL   = document.getElementById('mainLayer');
  const preview = document.getElementById('preview');
  const overlay = document.getElementById('overlay');
  const themeToggle = document.getElementById('themeToggle');
  const body = document.body;

  let canvas, ctx, recorder, chunks;

  // Initialize canvas for image/video export
  function initCanvas(){
    if(!canvas) {
      canvas = document.createElement('canvas');
    }
    canvas.width = preview.clientWidth * devicePixelRatio;
    canvas.height = preview.clientHeight * devicePixelRatio;
    ctx = canvas.getContext('2d');
    ctx.scale(devicePixelRatio, devicePixelRatio);
  }

  // Draw snapshot of current view on canvas
  function renderSnapshot(){
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    // Background layer blur texts
    ctx.globalAlpha = 0.2;
    ctx.fillStyle = body.classList.contains('light') ? '#222' : '#fff';
    ctx.fillRect(0,0,canvas.width, canvas.height);
    ctx.globalAlpha = 1;
    const fontSize = preview.clientHeight/6;
    ctx.font = `600 ${fontSize}px Roboto Mono`;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';

    // Draw background blur texts randomly positioned with lower opacity
    for(let i=0; i<blurTexts.length; i++){
      const text = blurTexts[i];
      const x = Math.random() * canvas.width;
      const y = Math.random() * canvas.height;
      ctx.fillStyle = 'rgba(245,197,24,0.15)';
      ctx.fillText(text, x, y);
    }
    // Draw main text
    const mainText = txt.value.trim();
    if(mainText.length>0){
      ctx.font = `900 ${fontSize}px Roboto Mono`;
      ctx.fillStyle = 'rgba(245,197,24,1)';
      ctx.fillText(mainText, canvas.width/2, canvas.height/2);
    }
  }

  // Show overlay message for duration ms
  function showOverlay(msg, duration=2000){
    overlay.textContent = msg;
    overlay.classList.add('visible');
    setTimeout(() => {
      overlay.classList.remove('visible');
    }, duration);
  }

  // Create animation and show text
  create.addEventListener('click', async () => {
    const text = txt.value.trim();
    if(text.length === 0){
      alert('Please enter text!');
      return;
    }
    create.disabled = true;
    dlPng.disabled = true;
    dlMp4.disabled = true;

    // Clear layers
    bgLayer.innerHTML = '';
    mainL.textContent = '';
    mainL.style.display = 'none';
    bgLayer.style.display = 'block';

    // Setup background blur text spans with same font size
    const fontSize = preview.clientHeight / 6;
    for(let i=0; i<blurTexts.length; i++){
      const span = document.createElement('span');
      span.textContent = blurTexts[i];
      span.style.fontSize = fontSize + 'px';
      // Random 3D position for subtle depth effect
      const tx = (Math.random()-0.5) * 300;
      const ty = (Math.random()-0.5) * 150;
      const tz = (Math.random()-0.5) * 200;
      span.style.transform = `translate3d(${tx}px, ${ty}px, ${tz}px)`;
      bgLayer.appendChild(span);
    }

    // Add animation class
    bgLayer.classList.add('animate');

    // Delay to simulate loading / create effect with countdown
    let counter = 3;
    showOverlay(`Creating... ${counter}`);
    const interval = setInterval(() => {
      counter--;
      if(counter > 0) showOverlay(`Creating... ${counter}`);
      else {
        clearInterval(interval);
        overlay.classList.remove('visible');
        mainL.textContent = text;
        mainL.style.fontSize = fontSize + 'px';
        mainL.classList.add('show');
        dlPng.disabled = false;
        dlMp4.disabled = false;
        create.disabled = false;
      }
    }, 1000);
  });

  // Download PNG
  dlPng.addEventListener('click', () => {
    initCanvas();
    renderSnapshot();
    canvas.toBlob(blob => {
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `3d_paper_text_${Date.now()}.png`;
      a.click();
      URL.revokeObjectURL(a.href);
      showOverlay('Bizi tercih ettiğiniz için teşekkürler!', 2500);
    });
  });

  // Download MP4 (WebM) 3 second video recording
  dlMp4.addEventListener('click', () => {
    initCanvas();
    renderSnapshot();
    const stream = canvas.captureStream(30);
    recorder = new MediaRecorder(stream, {mimeType: 'video/webm; codecs=vp9'});
    chunks = [];
    recorder.ondataavailable = e => {
      if(e.data.size > 0) chunks.push(e.data);
    };
    recorder.onstop = () => {
      const blob = new Blob(chunks, {type: 'video/webm'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `3d_paper_text_${Date.now()}.webm`;
      a.click();
      URL.revokeObjectURL(url);
      showOverlay('Bizi tercih ettiğiniz için teşekkürler!', 2500);
    };
    recorder.start();
    setTimeout(() => recorder.stop(), 3000);
  });

  // Theme toggle logic
  themeToggle.addEventListener('click', () => {
    if(body.classList.contains('light')){
      body.classList.remove('light');
      themeToggle.textContent = 'Light Mode';
    } else {
      body.classList.add('light');
      themeToggle.textContent = 'Dark Mode';
    }
  });

  // Initialize canvas on resize
  window.addEventListener('resize', () => {
    if(canvas) {
      canvas.width = preview.clientWidth * devicePixelRatio;
      canvas.height = preview.clientHeight * devicePixelRatio;
      ctx.scale(devicePixelRatio, devicePixelRatio);
    }
  });

})();
</script>
</body>
</html>
